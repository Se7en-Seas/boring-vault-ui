---
title: Solana Vault Integration
description: Complete SDK for interacting with Boring Vault on Solana blockchain
---

## Introduction

The Boring Vault Solana SDK provides comprehensive tools for interacting with Boring Vault on the Solana blockchain. This SDK supports both SPL token deposits and native SOL deposits, along with queued withdrawals and comprehensive vault management.

## Features

- ✅ **SPL Token Deposits** - Deposit any supported SPL token into vaults
- ✅ **Native SOL Deposits** - Direct SOL deposits without wrapping
- ✅ **Queued Withdrawals** - Request withdrawals through the Boring Queue system
- ✅ **Input Validation** - Automatic validation of deposit amounts and parameters
- ✅ **Wallet Support** - Compatible with both wallet adapters and keypairs
- ✅ **Error Handling** - Comprehensive error handling with detailed messages
- ✅ **Transaction Monitoring** - Built-in transaction status polling and explorer links

## VaultSDK

The `VaultSDK` class is the main interface for interacting with Boring Vault on Solana.

### Installation & Setup

```tsx
import { VaultSDK } from 'boring-vault-ui';

// Initialize the SDK with an RPC URL
const vaultSDK = new VaultSDK('https://api.mainnet-beta.solana.com');
// You can also use shortcuts like 'mainnet', 'devnet', 'testnet'
const vaultSDK = new VaultSDK('mainnet');
```

### Getting Vault Information

#### Get Complete Vault Data

```tsx
import { web3 } from '@coral-xyz/anchor';

async function getVaultInfo() {
  const vaultAddress = new web3.PublicKey('your_vault_address_here');
  
  try {
    const vaultData = await vaultSDK.getVaultData(vaultAddress);
    
    console.log('Vault ID:', vaultData.vaultState.vaultId.toString());
    console.log('Authority:', vaultData.vaultState.authority.toString());
    console.log('Share Mint:', vaultData.vaultState.shareMint.toString());
    console.log('Paused:', vaultData.vaultState.paused);
    console.log('Deposit Sub-Account:', vaultData.vaultState.depositSubAccount);
    console.log('Withdraw Sub-Account:', vaultData.vaultState.withdrawSubAccount);
    
    // Teller state information
    if (vaultData.tellerState) {
      console.log('Base Asset:', vaultData.tellerState.baseAsset.toString());
      console.log('Exchange Rate:', vaultData.tellerState.exchangeRate.toString());
      console.log('Platform Fee:', vaultData.tellerState.platformFeeBps / 100, '%');
      console.log('Performance Fee:', vaultData.tellerState.performanceFeeBps / 100, '%');
    }
    
    return vaultData;
  } catch (error) {
    console.error('Error fetching vault data:', error);
    return null;
  }
}
```

#### Get Vault Balance

```tsx
async function checkVaultBalance() {
  const vaultAddress = new web3.PublicKey('your_vault_address_here');
  
  try {
    const balance = await vaultSDK.getVaultBalance(vaultAddress);
    console.log(`Vault balance: ${balance} lamports`);
    return balance;
  } catch (error) {
    console.error('Error fetching vault balance:', error);
    return '0';
  }
}
```

### Depositing Assets

#### SPL Token Deposits

```tsx
import { web3 } from '@coral-xyz/anchor';

async function depositTokens() {
  // Your wallet (can be wallet adapter or keypair)
  const wallet = {
    publicKey: new web3.PublicKey('user_wallet_address'),
    signTransaction: async (tx: web3.Transaction) => {
      // Wallet adapter signing logic
      return signedTransaction;
    }
  };
  
  // Or use a keypair directly
  // const wallet = web3.Keypair.fromSecretKey(secretKey);
  
  const vaultId = 1;
  const tokenMint = 'J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn'; // jitoSOL
  const depositAmount = BigInt('1000000000'); // 1 token (with 9 decimals)
  const minMintAmount = BigInt('950000000');  // 5% slippage tolerance
  
  try {
    const signature = await vaultSDK.deposit(
      wallet,
      vaultId,
      tokenMint,
      depositAmount,
      minMintAmount,
      {
        skipPreflight: false,
        maxRetries: 30
      }
    );
    
    console.log(`Deposit successful! Transaction: ${signature}`);
    console.log(`View on explorer: https://solscan.io/tx/${signature}`);
    
    return signature;
  } catch (error) {
    console.error('Deposit failed:', error);
    throw error;
  }
}
```

#### Native SOL Deposits

```tsx
async function depositSOL() {
  const wallet = /* your wallet */;
  const vaultId = 1;
  const depositAmount = BigInt('1000000000'); // 1 SOL in lamports
  const minMintAmount = BigInt('950000000');  // 5% slippage tolerance
  
  try {
    const signature = await vaultSDK.depositSol(
      wallet,
      vaultId,
      depositAmount,
      minMintAmount,
      {
        skipPreflight: false,
        maxRetries: 30
      }
    );
    
    console.log(`SOL deposit successful! Transaction: ${signature}`);
    console.log(`View on explorer: https://solscan.io/tx/${signature}`);
    
    return signature;
  } catch (error) {
    console.error('SOL deposit failed:', error);
    throw error;
  }
}
```

### Queued Withdrawals

The SDK supports queued withdrawals through the Boring Queue system, allowing users to request withdrawals that can be fulfilled by external solvers at a discount.

```tsx
async function queueWithdrawal() {
  const wallet = /* your wallet */;
  const vaultId = 1;
  const tokenOut = 'J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn'; // jitoSOL
  const shareAmount = 0.5; // Human-readable amount (0.5 shares)
  const discountPercent = 2.5; // 2.5% discount for solvers
  const secondsToDeadline = 86400 * 7; // 7 days
  
  try {
    const signature = await vaultSDK.queueBoringWithdraw(
      wallet,
      vaultId,
      tokenOut,
      shareAmount,
      discountPercent,
      secondsToDeadline,
      {
        skipPreflight: false,
        maxRetries: 30
      }
    );
    
    console.log(`Withdrawal queued! Transaction: ${signature}`);
    console.log(`View on explorer: https://solscan.io/tx/${signature}`);
    
    return signature;
  } catch (error) {
    console.error('Queue withdrawal failed:', error);
    throw error;
  }
}
```

## BoringVaultSolana (Low-Level API)

For advanced use cases, you can access the low-level `BoringVaultSolana` class directly.

### Creating a BoringVaultSolana Instance

```tsx
import { createBoringVaultSolana } from 'boring-vault-ui';

const boringVault = createBoringVaultSolana({
  urlOrMoniker: 'mainnet',
  programId: '5ZRnXG4GsUMLaN7w2DtJV1cgLgcXHmuHCmJ2MxoorWCE'
});
```

### User Share Balances

```tsx
async function getUserShares() {
  const walletAddress = 'user_wallet_address_here';
  const vaultId = 1;
  
  try {
    const balanceInfo = await boringVault.fetchUserShares(walletAddress, vaultId);
    
    console.log('Raw Balance:', balanceInfo.raw.toString());
    console.log('Formatted Balance:', balanceInfo.formatted);
    console.log('Decimals:', balanceInfo.decimals);
    
    return balanceInfo;
  } catch (error) {
    console.error('Error fetching user shares:', error);
    return null;
  }
}
```

### Building Transactions

#### SPL Token Deposit Transaction

```tsx
async function buildDepositTx() {
  const payerPublicKey = new web3.PublicKey('payer_address');
  const vaultId = 1;
  const depositMint = new web3.PublicKey('J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn');
  const depositAmount = BigInt('1000000000');
  const minMintAmount = BigInt('950000000');
  
  try {
    const transaction = await boringVault.buildDepositTransaction(
      payerPublicKey,
      vaultId,
      depositMint,
      depositAmount,
      minMintAmount
    );
    
    console.log('Transaction built successfully');
    return transaction;
  } catch (error) {
    console.error('Error building transaction:', error);
    throw error;
  }
}
```

#### SOL Deposit Transaction

```tsx
async function buildSOLDepositTx() {
  const payerPublicKey = new web3.PublicKey('payer_address');
  const vaultId = 1;
  const depositAmount = BigInt('1000000000'); // 1 SOL
  const minMintAmount = BigInt('950000000');
  
  try {
    const transaction = await boringVault.buildDepositSolTransaction(
      payerPublicKey,
      vaultId,
      depositAmount,
      minMintAmount
    );
    
    console.log('SOL deposit transaction built successfully');
    return transaction;
  } catch (error) {
    console.error('Error building SOL deposit transaction:', error);
    throw error;
  }
}
```

### PDA Derivations

```tsx
// Get vault state PDA
const vaultStatePDA = await boringVault.getVaultStatePDA(vaultId);

// Get vault PDA for specific sub-account
const vaultPDA = await boringVault.getVaultPDA(vaultId, subAccount);

// Get share token mint PDA
const shareMintPDA = await boringVault.getShareTokenPDA(vaultStatePDA);

// Get asset data PDA
const assetDataPDA = await boringVault.getAssetDataPDA(vaultStatePDA, assetMint);

// Queue-related PDAs
const queueStatePDA = await boringVault.getQueueStatePDA(vaultId);
const queuePDA = await boringVault.getQueuePDA(vaultId);
const userWithdrawStatePDA = await boringVault.getUserWithdrawStatePDA(userPublicKey);
```

## Working with Keypairs

For testing or administrative operations, you may need to load keypairs from Solana CLI format:

```tsx
import { createKeyPairSignerFromPrivateKeyBytes } from 'gill';
import * as fs from 'fs';

async function loadKeypair(keypairPath: string) {
  try {
    const keyData = JSON.parse(fs.readFileSync(keypairPath, 'utf-8'));
    const secretKey = new Uint8Array(keyData);
    
    // Extract private key bytes (first 32 bytes)
    const privateKeyBytes = secretKey.slice(0, 32);
    
    // Create keypair signer
    const keypairSigner = await createKeyPairSignerFromPrivateKeyBytes(privateKeyBytes);
    
    console.log(`Loaded keypair: ${keypairSigner.address}`);
    return keypairSigner;
  } catch (error) {
    console.error('Failed to load keypair:', error);
    throw error;
  }
}
```

## Input Validation

The SDK automatically validates input parameters:

- **Deposit amounts** must be positive non-zero values
- **Minimum mint amounts** must be positive non-zero values  
- **Discount percentages** must be between 0% and 5%
- **Share amounts** must be greater than 0
- **Deadline seconds** must be at least 1 hour

```tsx
// These will throw validation errors:
await vaultSDK.deposit(wallet, vaultId, mint, BigInt(0), minAmount); // ❌ Zero deposit
await vaultSDK.depositSol(wallet, vaultId, BigInt(-1), minAmount); // ❌ Negative amount
await vaultSDK.queueBoringWithdraw(wallet, vaultId, tokenOut, 0, 10); // ❌ 10% discount too high
```

## Error Handling

The SDK provides comprehensive error handling with detailed messages:

```tsx
try {
  await vaultSDK.deposit(/* ... */);
} catch (error) {
  if (error.message.includes('Invalid depositAmount')) {
    console.error('Deposit amount validation failed');
  } else if (error.message.includes('Asset not allowed')) {
    console.error('This asset is not supported for deposits');
  } else if (error.message.includes('Vault paused')) {
    console.error('Vault is currently paused');
  } else {
    console.error('Unexpected error:', error);
  }
}
```

## Complete Example

Here's a comprehensive example showing common vault operations:

```tsx
import { VaultSDK, createBoringVaultSolana } from 'boring-vault-ui';
import { web3 } from '@coral-xyz/anchor';

async function vaultOperationsExample() {
  // Initialize SDK
  const vaultSDK = new VaultSDK('mainnet');
  const vaultAddress = new web3.PublicKey('your_vault_address_here');
  const vaultId = 1;
  
  // Your wallet setup
  const wallet = /* your wallet */;
  
  try {
    // 1. Get vault information
    console.log('=== Fetching Vault Data ===');
    const vaultData = await vaultSDK.getVaultData(vaultAddress);
    console.log(`Vault ID: ${vaultData.vaultState.vaultId}`);
    console.log(`Authority: ${vaultData.vaultState.authority}`);
    console.log(`Paused: ${vaultData.vaultState.paused}`);
    
    // 2. Check vault balance
    console.log('\n=== Checking Vault Balance ===');
    const vaultBalance = await vaultSDK.getVaultBalance(vaultAddress);
    console.log(`Vault Balance: ${vaultBalance} lamports`);
    
    // 3. Check user share balance
    console.log('\n=== Checking User Shares ===');
    const boringVault = vaultSDK.getBoringVault();
    const userShares = await boringVault.fetchUserShares(
      wallet.publicKey.toString(),
      vaultId
    );
    console.log(`User Shares: ${userShares.formatted}`);
    
    // 4. Deposit SOL
    console.log('\n=== Depositing SOL ===');
    const depositAmount = BigInt('100000000'); // 0.1 SOL
    const minMintAmount = BigInt('95000000');  // 5% slippage
    
    const depositSignature = await vaultSDK.depositSol(
      wallet,
      vaultId,
      depositAmount,
      minMintAmount
    );
    console.log(`SOL Deposit Success: ${depositSignature}`);
    
    // 5. Queue withdrawal
    console.log('\n=== Queuing Withdrawal ===');
    const withdrawSignature = await vaultSDK.queueBoringWithdraw(
      wallet,
      vaultId,
      'J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn', // jitoSOL
      0.05, // 0.05 shares
      1.0,  // 1% discount
      86400 * 7 // 7 days deadline
    );
    console.log(`Withdrawal Queued: ${withdrawSignature}`);
    
  } catch (error) {
    console.error('Operation failed:', error);
  }
}
```

## Constants

The SDK includes useful constants for Solana operations:

```tsx
import {
  BORING_VAULT_PROGRAM_ID,
  BORING_QUEUE_PROGRAM_ID,
  JITO_SOL_MINT_ADDRESS,
  TOKEN_2022_PROGRAM_ID,
  DEFAULT_DECIMALS
} from 'boring-vault-ui';

console.log('Boring Vault Program:', BORING_VAULT_PROGRAM_ID);
console.log('Boring Queue Program:', BORING_QUEUE_PROGRAM_ID);
console.log('JitoSOL Mint:', JITO_SOL_MINT_ADDRESS);
console.log('Default Decimals:', DEFAULT_DECIMALS);
```

## Transaction Options

All transaction methods support the following options:

```tsx
interface TransactionOptions {
  skipPreflight?: boolean;    // Skip transaction simulation (default: false)
  maxRetries?: number;        // Maximum retry attempts (default: 30)
  skipStatusCheck?: boolean;  // Skip status polling (default: false)
}
```

## Best Practices

1. **Always validate inputs** - The SDK validates automatically, but check business logic too
2. **Handle errors gracefully** - Network issues and program errors can occur
3. **Use appropriate slippage** - 5% is usually safe for most operations
4. **Monitor transactions** - Use the provided explorer links to track status
5. **Test on devnet first** - Always test new integrations on devnet
6. **Reserve SOL for fees** - Keep ~0.01 SOL for transaction fees when depositing SOL
7. **Check vault status** - Ensure vaults aren't paused before attempting operations 

### Updating price feeds 

To guarantee the freshest JitoSOL/SOL price — crank the Pyth oracle just before sending your state-changing transaction:

```tsx
import { buildPythOracleCrankTransactions } from 'boring-vault-ui/solana/';
import { JITOSOL_SOL_PYTH_FEED } from 'boring-vault-ui';

const { transactions, signers } = await buildPythOracleCrankTransactions(
  connection,
  payer.publicKey,
  [JITOSOL_SOL_PYTH_FEED]
);

for (let i = 0; i < transactions.length; i++) {
  transactions[i].sign(...signers[i], keypair);
  await connection.sendRawTransaction(transactions[i].serialize());
}
```
